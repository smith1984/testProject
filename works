
        //Запрос на поиск записей за последний час
        Instant instant = ((Instant)session.getNamedQuery("findMaxTimeStamp").list().get(0)).minus(Duration.ofHours(1));

        Query query = session.getNamedQuery("selectRecordWithTSMore");
        query.setParameter("hour", instant);

        Set<String> set = new HashSet<>();
        for(Object r: query.list()){
                set.add(r[0] + ";" + r[1]);
            }

       //Запрос на поиск 5 самое часто используемых форм
       Query query =session.getNamedQuery("ratingForms").setMaxResults(5);
               List<Object[]> objectList= query.list();
               query = session.getNamedQuery("countUseForm");
               long count = (long)query.list().get(0);
               objectList.forEach(obj -> System.out.println((long)obj[0]*100*1.0/count*1.0 + "% " + obj[1] + " " + obj[2]));



             select r.ts, r.ssoid, r.formid, r.subtype from records r join (select max(ts), ssoid, formid from records rec where formid is not null and ssoid <> '' and ssoid <> 'Unauthorized'  group by ssoid, formid) where r.ts = rec.ts and r.ssoid = rec.ssoid and r.formid = rec.formid;


               select max(ts), ssoid, formid from records where subtype <> 'send' and formid is not null and ssoid <> '' and ssoid <> 'Unauthorized'  group by ssoid, formid;

 select r.ts, r.ssoid, r.formid, r.subtype from records r where r.ts = rec.ts and r.ssoid = rec.ssoid and r.formid = rec.formid (select max(ts), ssoid, formid from records rec where formid is not null and ssoid <> '' and ssoid <> 'Unauthorized'  group by ssoid, formid);



 select r.ts, r.ssoid, r.formid, r.subtype from records r join (select max(ts) ts, ssoid, formid from records where formid is not null and ssoid <> '' and ssoid <> 'Unauthorized'  group by ssoid, formid) AS rec on r.ts = rec.ts and r.ssoid = rec.ssoid and r.formid = rec.formid;

